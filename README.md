# Admin Scaffold RBAC

åŸºäº Next.js 15 + Hono + Drizzle ORM çš„åå°ç®¡ç†ç³»ç»Ÿè„šæ‰‹æ¶ï¼Œå®ç°å®Œæ•´çš„ RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰æƒé™ç®¡ç†å’Œæ“ä½œæ—¥å¿—è®°å½•åŠŸèƒ½ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ” **ç‹¬ç«‹ç®¡ç†å‘˜ä½“ç³»** - ä¸ C ç«¯ç”¨æˆ·åˆ†ç¦»çš„ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿ
- ğŸ­ **RBAC æƒé™æ§åˆ¶** - åŸºäºè§’è‰²çš„ç»†ç²’åº¦æƒé™ç®¡ç†ï¼ˆç›®å½•-èœå•-æŒ‰é’®ä¸‰çº§ç»“æ„ï¼‰
- ğŸ“ **æ“ä½œæ—¥å¿—** - å®Œæ•´çš„ç®¡ç†å‘˜æ“ä½œè¡Œä¸ºè¿½è¸ª
- ğŸš€ **ç±»å‹å®‰å…¨** - ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨çš„ API è°ƒç”¨ï¼ˆHono RPCï¼‰
- ğŸ“š **OpenAPI æ–‡æ¡£** - è‡ªåŠ¨ç”Ÿæˆçš„ Swagger API æ–‡æ¡£
- âš¡ **é«˜æ€§èƒ½** - æƒé™ç¼“å­˜ã€å¼‚æ­¥æ—¥å¿—è®°å½•

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ä½œç”¨ |
|------|------|
| **Next.js 15** | React å…¨æ ˆæ¡†æ¶ï¼ˆApp Routerï¼‰ |
| **Hono** | è½»é‡çº§ Web æ¡†æ¶ + RPC Client |
| **Drizzle ORM** | ç±»å‹å®‰å…¨çš„ SQL ORM |
| **MySQL 8.0+** | å…³ç³»å‹æ•°æ®åº“ |
| **TanStack Query** | æœåŠ¡ç«¯çŠ¶æ€ç®¡ç† |
| **Zustand** | å®¢æˆ·ç«¯çŠ¶æ€ç®¡ç† |
| **Tailwind CSS** | åŸå­åŒ– CSS æ¡†æ¶ |
| **Zod** | è¿è¡Œæ—¶ Schema æ ¡éªŒ |

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 18+
- pnpm 8+
- MySQL 8.0+

### å®‰è£…ä¾èµ–

```bash
pnpm install
```

### é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿å¹¶ä¿®æ”¹é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# æ•°æ®åº“é…ç½® (MySQL)
DATABASE_URL="mysql://root:password@localhost:3306/admin_scaffold"

# JWT é…ç½®
JWT_SECRET="your-super-secret-jwt-key-at-least-32-chars"
JWT_EXPIRES_IN="7d"

# å®¢æˆ·ç«¯é…ç½®
NEXT_PUBLIC_APP_URL="http://localhost:3000"
```

### åˆå§‹åŒ–æ•°æ®åº“

```bash
# åŒæ­¥æ•°æ®åº“ç»“æ„
pnpm db:push

# åˆå§‹åŒ–ç§å­æ•°æ®
pnpm db:seed
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

è®¿é—® http://localhost:3000 å¹¶ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•ï¼š

- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/[[...route]]/         # Hono API å…¥å£
â”‚   â”œâ”€â”€ (auth)/                   # è®¤è¯ç›¸å…³é¡µé¢
â”‚   â”‚   â””â”€â”€ login/                # ç™»å½•é¡µ
â”‚   â””â”€â”€ (dashboard)/              # åå°ç®¡ç†é¡µé¢
â”‚       â”œâ”€â”€ page.tsx              # ä»ªè¡¨ç›˜é¦–é¡µ
â”‚       â””â”€â”€ system/               # ç³»ç»Ÿç®¡ç†
â”‚           â”œâ”€â”€ admin/            # ç”¨æˆ·ç®¡ç†
â”‚           â”œâ”€â”€ role/             # è§’è‰²ç®¡ç†
â”‚           â”œâ”€â”€ menu/             # èœå•ç®¡ç†
â”‚           â””â”€â”€ log/              # æ“ä½œæ—¥å¿—
â”œâ”€â”€ components/                   # React ç»„ä»¶
â”‚   â”œâ”€â”€ layout/                   # å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ ui/                       # UI ç»„ä»¶
â”œâ”€â”€ db/                           # æ•°æ®åº“æ¨¡å—
â”‚   â”œâ”€â”€ schema/                   # Drizzle Schema
â”‚   â”œâ”€â”€ index.ts                  # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ seed.ts                   # ç§å­æ•°æ®è„šæœ¬
â”œâ”€â”€ hooks/                        # React Hooks
â”‚   â”œâ”€â”€ queries/                  # React Query Hooks
â”‚   â”œâ”€â”€ use-auth.ts               # è®¤è¯çŠ¶æ€ Hook
â”‚   â””â”€â”€ use-permission.ts         # æƒé™æ£€æŸ¥ Hook
â”œâ”€â”€ lib/                          # å·¥å…·åº“
â”‚   â”œâ”€â”€ client.ts                 # Hono RPC Client
â”‚   â”œâ”€â”€ errors.ts                 # è‡ªå®šä¹‰é”™è¯¯ç±»
â”‚   â”œâ”€â”€ jwt.ts                    # JWT å·¥å…·
â”‚   â””â”€â”€ password.ts               # å¯†ç åŠ å¯†å·¥å…·
â””â”€â”€ server/                       # æœåŠ¡ç«¯æ¨¡å—
    â”œâ”€â”€ app.ts                    # Hono å®ä¾‹
    â”œâ”€â”€ middleware/               # ä¸­é—´ä»¶
    â”‚   â”œâ”€â”€ jwt-auth.ts           # JWT è®¤è¯
    â”‚   â”œâ”€â”€ rbac.ts               # RBAC æƒé™
    â”‚   â””â”€â”€ audit-log.ts          # æ“ä½œæ—¥å¿—
    â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘å±‚
    â””â”€â”€ routes/                   # API è·¯ç”±
```

## ğŸ”‘ åŠŸèƒ½æ¨¡å—

### ç”¨æˆ·ç®¡ç†

- ç®¡ç†å‘˜åˆ—è¡¨ï¼ˆåˆ†é¡µæŸ¥è¯¢ï¼‰
- åˆ›å»º/ç¼–è¾‘/åˆ é™¤ç®¡ç†å‘˜
- é‡ç½®å¯†ç 
- åˆ†é…è§’è‰²
- å¯ç”¨/ç¦ç”¨çŠ¶æ€

### è§’è‰²ç®¡ç†

- è§’è‰²åˆ—è¡¨
- åˆ›å»º/ç¼–è¾‘/åˆ é™¤è§’è‰²
- åˆ†é…èœå•æƒé™

### èœå•æƒé™ç®¡ç†

- æ ‘å½¢èœå•ç»“æ„
- ä¸‰ç§ç±»å‹ï¼šç›®å½•(D)ã€èœå•(M)ã€æŒ‰é’®(B)
- æƒé™æ ‡è¯†æ ¼å¼ï¼š`module:action`ï¼ˆå¦‚ `system:admin:list`ï¼‰

### æ“ä½œæ—¥å¿—

- è‡ªåŠ¨è®°å½•å¢åˆ æ”¹æ“ä½œ
- å¤šæ¡ä»¶ç­›é€‰ï¼ˆç®¡ç†å‘˜ã€æ¨¡å—ã€æ“ä½œç±»å‹ã€çŠ¶æ€ã€æ—¶é—´èŒƒå›´ï¼‰
- è®°å½•æ‰§è¡Œæ—¶é—´ã€IPã€User-Agent ç­‰ä¿¡æ¯

## ğŸ“¡ API æ¥å£

### è®¤è¯æ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/auth/login` | ç®¡ç†å‘˜ç™»å½• |
| POST | `/api/auth/logout` | ç®¡ç†å‘˜ç™»å‡º |
| GET | `/api/auth/info` | è·å–å½“å‰ç®¡ç†å‘˜ä¿¡æ¯ |

### ç®¡ç†å‘˜æ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/admins` | è·å–ç®¡ç†å‘˜åˆ—è¡¨ |
| POST | `/api/admins` | åˆ›å»ºç®¡ç†å‘˜ |
| GET | `/api/admins/:id` | è·å–ç®¡ç†å‘˜è¯¦æƒ… |
| PUT | `/api/admins/:id` | æ›´æ–°ç®¡ç†å‘˜ |
| DELETE | `/api/admins/:id` | åˆ é™¤ç®¡ç†å‘˜ |
| PUT | `/api/admins/:id/reset-password` | é‡ç½®å¯†ç  |
| PUT | `/api/admins/:id/roles` | æ›´æ–°ç®¡ç†å‘˜è§’è‰² |

### è§’è‰²æ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/roles` | è·å–è§’è‰²åˆ—è¡¨ |
| POST | `/api/roles` | åˆ›å»ºè§’è‰² |
| GET | `/api/roles/:id` | è·å–è§’è‰²è¯¦æƒ… |
| PUT | `/api/roles/:id` | æ›´æ–°è§’è‰² |
| DELETE | `/api/roles/:id` | åˆ é™¤è§’è‰² |
| PUT | `/api/roles/:id/menus` | æ›´æ–°è§’è‰²èœå•æƒé™ |

### èœå•æ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/menus` | è·å–èœå•åˆ—è¡¨ |
| GET | `/api/menus/tree` | è·å–èœå•æ ‘ |
| POST | `/api/menus` | åˆ›å»ºèœå• |
| GET | `/api/menus/:id` | è·å–èœå•è¯¦æƒ… |
| PUT | `/api/menus/:id` | æ›´æ–°èœå• |
| DELETE | `/api/menus/:id` | åˆ é™¤èœå• |

### æ“ä½œæ—¥å¿—æ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/operation-logs` | è·å–æ“ä½œæ—¥å¿—åˆ—è¡¨ |
| DELETE | `/api/operation-logs/:id` | åˆ é™¤æ“ä½œæ—¥å¿— |

### API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åè®¿é—® Swagger UIï¼šhttp://localhost:3000/api/swagger

## ğŸ§ª å¼€å‘å‘½ä»¤

```bash
# å¼€å‘æœåŠ¡å™¨
pnpm dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
pnpm start

# ä»£ç æ£€æŸ¥
pnpm lint

# ä»£ç æ ¼å¼åŒ–
pnpm lint:fix

# ç”Ÿæˆæ•°æ®åº“è¿ç§»
pnpm db:generate

# åŒæ­¥æ•°æ®åº“ç»“æ„
pnpm db:push

# æ‰“å¼€æ•°æ®åº“ç®¡ç†ç•Œé¢
pnpm db:studio

# åˆå§‹åŒ–ç§å­æ•°æ®
pnpm db:seed
```

## ğŸ”’ æƒé™æ§åˆ¶

### è¶…çº§ç®¡ç†å‘˜

è§’è‰² ID ä¸º 1 çš„ç®¡ç†å‘˜ä¸ºè¶…çº§ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œè·³è¿‡æƒé™éªŒè¯ã€‚

### æƒé™ç¼“å­˜

ç³»ç»Ÿä½¿ç”¨å†…å­˜ç¼“å­˜ç®¡ç†å‘˜æƒé™ï¼ˆ5 åˆ†é’Ÿ TTLï¼‰ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨æ¸…é™¤ç¼“å­˜ï¼š

- æ›´æ–°ç®¡ç†å‘˜è§’è‰²æ—¶æ¸…é™¤è¯¥ç®¡ç†å‘˜ç¼“å­˜
- æ›´æ–°è§’è‰²èœå•æƒé™æ—¶æ¸…é™¤æ‰€æœ‰ç¼“å­˜

### å‰ç«¯æƒé™æ§åˆ¶

```tsx
import { usePermission } from '@/hooks/use-permission'
import { PermissionGuard } from '@/components/permission-guard'

// Hook æ–¹å¼
function MyComponent() {
  const { hasPermission } = usePermission()

  if (hasPermission('system:admin:create')) {
    // æ˜¾ç¤ºåˆ›å»ºæŒ‰é’®
  }
}

// ç»„ä»¶æ–¹å¼
function MyPage() {
  return (
    <PermissionGuard permission="system:admin:list">
      <AdminTable />
    </PermissionGuard>
  )
}
```

## ğŸ“„ License

MIT
